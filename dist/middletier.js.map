{"version":3,"file":"middletier.js","mappings":"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","sources":["webpack://office-addin-taskpane-sso/./src/middle-tier/Sharepoint-helper.ts","webpack://office-addin-taskpane-sso/./src/middle-tier/msgraph-helper.ts","webpack://office-addin-taskpane-sso/./src/middle-tier/ssoauth-helper.ts","webpack://office-addin-taskpane-sso/external commonjs \"cookie-parser\"","webpack://office-addin-taskpane-sso/external commonjs \"dotenv\"","webpack://office-addin-taskpane-sso/external commonjs \"express\"","webpack://office-addin-taskpane-sso/external commonjs \"form-urlencoded\"","webpack://office-addin-taskpane-sso/external commonjs \"http-errors\"","webpack://office-addin-taskpane-sso/external commonjs \"jsonwebtoken\"","webpack://office-addin-taskpane-sso/external commonjs \"jwks-rsa\"","webpack://office-addin-taskpane-sso/external commonjs \"morgan\"","webpack://office-addin-taskpane-sso/external commonjs \"node-fetch\"","webpack://office-addin-taskpane-sso/external commonjs \"node-sp-auth\"","webpack://office-addin-taskpane-sso/external commonjs \"office-addin-dev-certs\"","webpack://office-addin-taskpane-sso/external commonjs \"path\"","webpack://office-addin-taskpane-sso/external commonjs \"request-promise\"","webpack://office-addin-taskpane-sso/external node-commonjs \"https\"","webpack://office-addin-taskpane-sso/webpack/bootstrap","webpack://office-addin-taskpane-sso/webpack/runtime/compat get default export","webpack://office-addin-taskpane-sso/webpack/runtime/define property getters","webpack://office-addin-taskpane-sso/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane-sso/webpack/runtime/make namespace object","webpack://office-addin-taskpane-sso/./src/middle-tier/app.ts"],"sourcesContent":["import * as spauth from \"node-sp-auth\";\nimport * as request from \"request-promise\";\n\nexport async function getSharepointData(req: any, res: any, next: any) {\n  spauth\n    .getAuth(\"https://vichitra.sharepoint.com/sites/dev/\", {\n      clientId: \"6dc9bad4-bea5-46f1-a47e-6430d2c83ae4\",\n      clientSecret: \"qc0syH8nllqvMlKON7wmR9S8fJ2k/GTVJXqv2PiS0Vc=\",\n      realm: \"6621c5f1-da8a-4ee5-9708-7b6b5334d53b\",\n    })\n    .then((options) => {\n      //perform request with any http-enabled library (request-promise in a sample below):\n      let headers = options.headers;\n      headers[\"Accept\"] = \"application/json;odata=verbose\";\n      request\n        .get({\n          url: \"https://vichitra.sharepoint.com/sites/dev/_api/web\",\n          headers: headers,\n        })\n        .then((response) => {\n          console.log(response);\n          res.send(response);\n        });\n    });\n}\nexport async function getSharepointDdoc(req: any, res: any, next: any) {\n  let docUrl = req.get(\"Docurl\");\n  spauth\n    .getAuth(\"https://vichitra.sharepoint.com/sites/dev/\", {\n      clientId: \"6dc9bad4-bea5-46f1-a47e-6430d2c83ae4\",\n      clientSecret: \"qc0syH8nllqvMlKON7wmR9S8fJ2k/GTVJXqv2PiS0Vc=\",\n      realm: \"6621c5f1-da8a-4ee5-9708-7b6b5334d53b\",\n    })\n    .then((options) => {\n      //perform request with any http-enabled library (request-promise in a sample below):\n      let headers = options.headers;\n      headers[\"Accept\"] = \"application/json;odata=verbose\";\n      request\n        .get({\n          url: `https://vichitra.sharepoint.com/sites/dev/_api/Web/GetFileByServerRelativePath(decodedurl='${docUrl}')`,\n          headers: headers,\n        })\n        .then((response) => {\n          console.log(response);\n          res.send(response);\n        });\n    });\n}\n\nexport async function CreateRequestSP(req, next, res) {\n  let data = req.get(\"Data\");\n  console.log(data);\n\n  spauth\n    .getAuth(\"https://vichitra.sharepoint.com/sites/dev/\", {\n      clientId: \"6dc9bad4-bea5-46f1-a47e-6430d2c83ae4\",\n      clientSecret: \"qc0syH8nllqvMlKON7wmR9S8fJ2k/GTVJXqv2PiS0Vc=\",\n      realm: \"6621c5f1-da8a-4ee5-9708-7b6b5334d53b\",\n    })\n    .then((options) => {\n      //perform request with any http-enabled library (request-promise in a sample below):\n      let headers = options.headers;\n      (headers[\"Accept\"] = \"application/json;odata=nometadata\"),\n        (headers[\"Content-Type\"] = \"application/json\"),\n        request\n          .post({\n            url: \"https://vichitra.sharepoint.com/sites/dev/_api/web/lists/getbytitle('InvestcorpDocumentAssignees')/items\",\n            headers: headers,\n            body: data,\n          })\n          .then((response) => {\n            console.log(response);\n          });\n    });\n}\nexport async function UpdateRequestSP(req, next, res) {\n  let data = req.get(\"Data\");\n  let itemID = req.get(\"Itemid\");\n  console.log(data);\n\n  spauth\n    .getAuth(\"https://vichitra.sharepoint.com/sites/dev/\", {\n      clientId: \"6dc9bad4-bea5-46f1-a47e-6430d2c83ae4\",\n      clientSecret: \"qc0syH8nllqvMlKON7wmR9S8fJ2k/GTVJXqv2PiS0Vc=\",\n      realm: \"6621c5f1-da8a-4ee5-9708-7b6b5334d53b\",\n    })\n    .then((options) => {\n      //perform request with any http-enabled library (request-promise in a sample below):\n      let headers = options.headers;\n      (headers[\"Accept\"] = \"application/json;odata=nometadata\"),\n        (headers[\"Content-Type\"] = \"application/json\"),\n        (headers[\"IF-MATCH\"] = \"*\"),\n        (headers[\"X-HTTP-Method\"] = \"MERGE\"),\n        request\n          .post({\n            url: `https://vichitra.sharepoint.com/sites/dev/_api/web/lists/getbytitle('InvestcorpDocumentAssignees')/items(${itemID})`,\n            headers: headers,\n            body: data,\n          })\n          .then((response) => {\n            console.log(response);\n          });\n    });\n}\n\n","// Copyright (c) Microsoft. All rights reserved. Licensed under the MIT license. See full license in the root of the repo.\n/*\n    This file provides the provides functionality to get Microsoft Graph data.\n*/\nimport * as https from \"https\";\nimport { getAccessToken } from \"./ssoauth-helper\";\nimport createError from \"http-errors\";\n\n/* global process */\n\nconst domain: string = \"graph.microsoft.com\";\nconst version: string = \"v1.0\";\n\nexport async function getUserData(req: any, res: any, next: any) {\n  const authorization: string = req.get(\"Authorization\");\n\n  await getAccessToken(authorization)\n    .then(async (graphTokenResponse) => {\n      if (graphTokenResponse && (graphTokenResponse.claims || graphTokenResponse.error)) {\n        res.send(graphTokenResponse);\n      } else {\n        const graphToken: string = graphTokenResponse.access_token;\n        const graphUrlSegment: string = process.env.GRAPH_URL_SEGMENT || \"/me\";\n        const graphQueryParamSegment: string = process.env.QUERY_PARAM_SEGMENT || \"\";\n\n        const graphData = await getGraphData(graphToken, graphUrlSegment, graphQueryParamSegment);\n\n        // If Microsoft Graph returns an error, such as invalid or expired token,\n        // there will be a code property in the returned object set to a HTTP status (e.g. 401).\n        // Relay it to the client. It will caught in the fail callback of `makeGraphApiCall`.\n        if (graphData.code) {\n          next(createError(graphData.code, \"Microsoft Graph error \" + JSON.stringify(graphData)));\n        } else {\n          res.send(graphData);\n        }\n      }\n    })\n    .catch((err) => {\n      res.status(401).send(err.message);\n      return;\n    });\n}\n\nexport async function getGraphData(accessToken: string, apiUrl: string, queryParams?: string): Promise<any> {\n  return new Promise<any>((resolve, reject) => {\n    const options: https.RequestOptions = {\n      host: domain,\n      path: \"/\" + version + apiUrl + queryParams,\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n        Authorization: \"Bearer \" + accessToken,\n        \"Cache-Control\": \"private, no-cache, no-store, must-revalidate\",\n        Expires: \"-1\",\n        Pragma: \"no-cache\",\n      },\n    };\n\n    https\n      .get(options, (response) => {\n        let body = \"\";\n        response.on(\"data\", (d) => {\n          body += d;\n        });\n        response.on(\"end\", () => {\n          // The response from the OData endpoint might be an error, say a\n          // 401 if the endpoint requires an access token and it was invalid\n          // or expired. But a message is not an error in the call of https.get,\n          // so the \"on('error', reject)\" line below isn't triggered.\n          // So, the code distinguishes success (200) messages from error\n          // messages and sends a JSON object to the caller with either the\n          // requested OData or error information.\n\n          let error;\n          if (response.statusCode === 200) {\n            let parsedBody = JSON.parse(body);\n            resolve(parsedBody);\n          } else {\n            error = new Error();\n            error.code = response.statusCode;\n            error.message = response.statusMessage;\n\n            // The error body sometimes includes an empty space\n            // before the first character, remove it or it causes an error.\n            body = body.trim();\n            error.bodyCode = JSON.parse(body).error.code;\n            error.bodyMessage = JSON.parse(body).error.message;\n            resolve(error);\n          }\n        });\n      })\n      .on(\"error\", reject);\n  });\n}\n\nexport async function getSearchedUsers(req: any, res: any, next: any) {\n  const authorization: string = req.get(\"Authorization\");\n  const data: string = req.get(\"data\");\n  await getAccessToken(authorization)\n    .then(async (graphTokenResponse) => {\n      if (graphTokenResponse && (graphTokenResponse.claims || graphTokenResponse.error)) {\n        res.send(graphTokenResponse);\n      } else {\n        const graphToken: string = graphTokenResponse.access_token;\n        const graphUrlSegment: string = \"/users?$select=displayName,id&$filter=startswith(displayName,'\" + data + \"')\";\n        //const graphUrlSegment: string = \"/users?$select=displayName,id\";\n        console.log(graphUrlSegment);\n        const graphQueryParamSegment: string = process.env.QUERY_PARAM_SEGMENT || \"\";\n        const graphData = await getGraphData(graphToken, graphUrlSegment, graphQueryParamSegment);\n        if (graphData.code) {\n          next(createError(graphData.code, \"Microsoft Graph error \" + JSON.stringify(graphData)));\n        } else {\n          res.send(graphData);\n        }\n      }\n    })\n    .catch((err) => {\n      res.status(401).send(err.message);\n      return;\n    });\n}\n","const DISCOVERY_KEYS_ENDPOINT = \"https://login.microsoftonline.com/common/discovery/v2.0/keys\";\n\nexport async function getAccessToken(authorization: string): Promise<any> {\n  if (!authorization) {\n    let error = new Error(\"No Authorization header was found.\");\n    return Promise.reject(error);\n  } else {\n    const scopeName: string = process.env.SCOPE || \"User.Read\";\n    const [, /* schema */ assertion] = authorization.split(\" \");\n\n    const tokenScopes = (jwt.decode(assertion) as jwt.JwtPayload).scp.split(\" \");\n    const accessAsUserScope = tokenScopes.find((scope) => scope === \"access_as_user\");\n    if (!accessAsUserScope) {\n      throw new Error(\"Missing access_as_user\");\n    }\n\n    const formParams = {\n      client_id: process.env.CLIENT_ID,\n      client_secret: process.env.CLIENT_SECRET,\n      grant_type: \"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n      assertion: assertion,\n      requested_token_use: \"on_behalf_of\",\n      scope: [scopeName].join(\" \"),\n    };\n\n    const stsDomain: string = \"https://login.microsoftonline.com\";\n    const tenant: string = \"common\";\n    const tokenURLSegment: string = \"oauth2/v2.0/token\";\n    const encodedForm = form(formParams);\n\n    const tokenResponse = await fetch(`${stsDomain}/${tenant}/${tokenURLSegment}`, {\n      method: \"POST\",\n      body: encodedForm,\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n      },\n    });\n    const json = await tokenResponse.json();\n    return json;\n  }\n}\n\nexport function validateJwt(req, res, next): void {\n  const authHeader = req.headers.authorization;\n  if (authHeader) {\n    const token = authHeader.split(\" \")[1];\n\n    const validationOptions = {\n      audience: process.env.CLIENT_ID,\n    };\n\n    jwt.verify(token, getSigningKeys, validationOptions, (err) => {\n      if (err) {\n        console.log(err);\n        return res.sendStatus(403);\n      }\n\n      next();\n    });\n  }\n}\n\nfunction getSigningKeys(header: any, callback: any) {\n  var client: JwksClient = new JwksClient({\n    jwksUri: DISCOVERY_KEYS_ENDPOINT,\n  });\n\n  client.getSigningKey(header.kid, function (err, key) {\n    callback(null, key.getPublicKey());\n  });\n}\n/*\n * Copyright (c) Microsoft. All rights reserved. Licensed under the MIT license. See full license in root of repo. -->\n *\n * This file defines the routes within the authRoute router.\n */\n\nimport fetch from \"node-fetch\";\nimport form from \"form-urlencoded\";\nimport jwt from \"jsonwebtoken\";\nimport { JwksClient } from \"jwks-rsa\";\n\n/* global process, console */\n","module.exports = require(\"cookie-parser\");","module.exports = require(\"dotenv\");","module.exports = require(\"express\");","module.exports = require(\"form-urlencoded\");","module.exports = require(\"http-errors\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"jwks-rsa\");","module.exports = require(\"morgan\");","module.exports = require(\"node-fetch\");","module.exports = require(\"node-sp-auth\");","module.exports = require(\"office-addin-dev-certs\");","module.exports = require(\"path\");","module.exports = require(\"request-promise\");","module.exports = require(\"https\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/*\n * Copyright (c) Microsoft. All rights reserved. Licensed under the MIT license. See full license in root of repo. -->\n *\n * This file is the main Node.js server file that defines the express middleware.\n */\n\nif (process.env.NODE_ENV !== \"production\") {\n  require(\"dotenv\").config();\n}\nimport createError from \"http-errors\";\nimport * as path from \"path\";\nimport * as cookieParser from \"cookie-parser\";\nimport * as logger from \"morgan\";\nimport express from \"express\";\nimport https from \"https\";\nimport { getHttpsServerOptions } from \"office-addin-dev-certs\";\nimport { getUserData, getSearchedUsers } from \"./msgraph-helper\";\nimport { validateJwt } from \"./ssoauth-helper\";\nimport { CreateRequestSP, UpdateRequestSP, getSharepointData, getSharepointDdoc } from \"./Sharepoint-helper\";\n/* global console, process, require, __dirname */\n\nconst app = express();\nconst port: number | string = process.env.API_PORT || \"3000\";\n\napp.set(\"port\", port);\n\n// view engine setup\napp.set(\"views\", path.join(__dirname, \"views\"));\napp.set(\"view engine\", \"pug\");\n\napp.use(logger(\"dev\"));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\n\n/* Turn off caching when developing */\nif (process.env.NODE_ENV !== \"production\") {\n  app.use(express.static(path.join(process.cwd(), \"dist\"), { etag: false }));\n\n  app.use(function (req, res, next) {\n    res.header(\"Cache-Control\", \"private, no-cache, no-store, must-revalidate\");\n    res.header(\"Expires\", \"-1\");\n    res.header(\"Pragma\", \"no-cache\");\n    next();\n  });\n} else {\n  // In production mode, let static files be cached.\n  app.use(express.static(path.join(process.cwd(), \"dist\")));\n}\n\nconst indexRouter = express.Router();\nindexRouter.get(\"/\", function (req, res) {\n  res.render(\"/taskpane.html\");\n});\n\napp.use(\"/\", indexRouter);\n\n// Middle-tier API calls\n// listen for 'ping' to verify service is running\n// Un comment for development debugging, but un needed for production deployment\n// app.get(\"/ping\", function (req: any, res: any) {\n//   res.send(process.platform);\n// });\n\n//app.get(\"/getuserdata\", validateJwt, getUserData);\napp.get(\"/getuserdata\", validateJwt, getUserData);\napp.get(\"/getSearchedADUsers\", validateJwt, getSearchedUsers);\napp.get(\"/getSPData\", validateJwt, getSharepointData);\napp.get(\"/GetSPDoc\", validateJwt, getSharepointDdoc);\napp.post(\"/CreateRequest\", validateJwt, CreateRequestSP);\napp.post(\"/UpdateRequest\", validateJwt, UpdateRequestSP);\n// Get the client side task pane files requested\napp.get(\"/taskpane.html\", async (req: any, res: any) => {\n  return res.sendfile(\"taskpane.html\");\n});\n\napp.get(\"/fallbackauthdialog.html\", async (req: any, res: any) => {\n  return res.sendfile(\"fallbackauthdialog.html\");\n});\n\n// Catch 404 and forward to error handler\napp.use(function (req: any, res: any, next: any) {\n  next(createError(404));\n});\n\n// error handler\napp.use(function (err: any, req: any, res: any) {\n  // set locals, only providing error in development\n  res.locals.message = err.message;\n  res.locals.error = req.app.get(\"env\") === \"development\" ? err : {};\n\n  // render the error page\n  res.status(err.status || 500);\n  res.render(\"error\");\n});\n\ngetHttpsServerOptions().then((options) => {\n  https\n    .createServer(options, app)\n    .listen(port, () => console.log(`Server running on ${port} in ${process.env.NODE_ENV} mode`));\n});\n"],"names":["spauth","request","getSharepointData","req","res","next","getAuth","clientId","clientSecret","realm","then","options","headers","get","url","response","console","log","send","getSharepointDdoc","docUrl","CreateRequestSP","data","post","body","UpdateRequestSP","itemID","https","getAccessToken","createError","domain","version","getUserData","authorization","graphTokenResponse","claims","error","graphToken","access_token","graphUrlSegment","process","env","GRAPH_URL_SEGMENT","graphQueryParamSegment","QUERY_PARAM_SEGMENT","graphData","getGraphData","code","JSON","stringify","catch","err","status","message","accessToken","apiUrl","queryParams","Promise","resolve","reject","host","path","method","Accept","Authorization","Expires","Pragma","on","d","statusCode","parsedBody","parse","Error","statusMessage","trim","bodyCode","bodyMessage","getSearchedUsers","DISCOVERY_KEYS_ENDPOINT","scopeName","SCOPE","assertion","split","tokenScopes","jwt","decode","scp","accessAsUserScope","find","scope","formParams","client_id","CLIENT_ID","client_secret","CLIENT_SECRET","grant_type","requested_token_use","join","stsDomain","tenant","tokenURLSegment","encodedForm","form","tokenResponse","fetch","json","validateJwt","authHeader","token","validationOptions","audience","verify","getSigningKeys","sendStatus","header","callback","client","JwksClient","jwksUri","getSigningKey","kid","key","getPublicKey","NODE_ENV","require","config","cookieParser","logger","express","getHttpsServerOptions","app","port","API_PORT","set","__dirname","use","urlencoded","extended","static","cwd","etag","indexRouter","Router","render","sendfile","locals","createServer","listen"],"sourceRoot":""}